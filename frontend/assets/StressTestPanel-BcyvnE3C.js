var I=Object.defineProperty;var L=(h,r,s)=>r in h?I(h,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[r]=s;var C=(h,r,s)=>L(h,typeof r!="symbol"?r+"":r,s);import{Y as E,u as B,r as k,j as t}from"./index-BuZGzeB0.js";import{p as x}from"./post.service-_8tU2b1P.js";import{a as z}from"./generated-C_sSMSzw.js";class U{constructor(){C(this,"results",{totalOperations:0,successfulOperations:0,failedOperations:0,averageResponseTime:0,operations:[]})}async runConcurrentLikeTest(r,s=10){console.log(`🚀 Starting concurrent like test with ${s} operations...`);const i=[];for(let a=0;a<s;a++)i.push(this.timedOperation(()=>x.toggleLike(r),`like-${a}`));return await Promise.all(i),this.generateReport("Concurrent Like Test")}async runConcurrentCommentTest(r,s=10){console.log(`🚀 Starting concurrent comment test with ${s} operations...`);const i=[];for(let a=0;a<s;a++)i.push(this.timedOperation(()=>x.addComment(r,`Stress test comment ${a} - ${Date.now()}`),`comment-${a}`));return await Promise.all(i),this.generateReport("Concurrent Comment Test")}async runMixedOperationsTest(r,s=20){console.log(`🚀 Starting mixed operations test with ${s} operations...`);const i=[];for(let a=0;a<s;a++){const n=r[Math.floor(Math.random()*r.length)],m=Math.random();m<.4?i.push(this.timedOperation(()=>x.toggleLike(n),`like-${a}`)):m<.7?i.push(this.timedOperation(()=>x.addComment(n,`Mixed test comment ${a}`),`comment-${a}`)):m<.9?i.push(this.timedOperation(()=>x.sharePost(n),`share-${a}`)):i.push(this.timedOperation(()=>x.createPost({content:`Stress test post ${a} - ${Date.now()}`,images:[]}),`create-${a}`))}return await Promise.all(i),this.generateReport("Mixed Operations Test")}async runRapidFireTest(r,s=5e3){console.log(`🚀 Starting rapid fire test for ${s}ms...`);const i=Date.now(),a=[];let n=0;const m=50,l=100;for(;Date.now()-i<s;){const f=[];for(let v=0;v<m&&Date.now()-i<s;v++)f.push(this.timedOperation(()=>x.toggleLike(r),`rapid-${n++}`));a.push(...f),Date.now()-i<s&&await new Promise(v=>setTimeout(v,l))}return await Promise.all(a),this.generateReport("Rapid Fire Test")}async runAuthenticationStressTest(r=5){console.log(`🚀 Starting authentication stress test with ${r} operations...`);const s=`stresstest${Date.now()}@test.com`,i="TestPassword123!";await this.timedOperation(()=>E.signup(`stressuser${Date.now()}`,s,i,"Stress Test User"),"register");const a=[];for(let n=0;n<r;n++)a.push(this.timedOperation(()=>E.login(s,i),`login-${n}`));return await Promise.all(a),this.generateReport("Authentication Stress Test")}async timedOperation(r,s){const i=performance.now();try{await r();const a=performance.now()-i;this.results.operations.push({type:s,success:!0,duration:a}),this.results.successfulOperations++}catch(a){const n=performance.now()-i;this.results.operations.push({type:s,success:!1,duration:n,error:a instanceof Error?a.message:"Unknown error"}),this.results.failedOperations++}this.results.totalOperations++}generateReport(r){const s=this.results.operations.reduce((n,m)=>n+m.duration,0);this.results.averageResponseTime=s/this.results.operations.length,console.log(`
📊 ${r} Results:`),console.log(`Total Operations: ${this.results.totalOperations}`),console.log(`✅ Successful: ${this.results.successfulOperations}`),console.log(`❌ Failed: ${this.results.failedOperations}`),console.log(`⏱️  Average Response Time: ${this.results.averageResponseTime.toFixed(2)}ms`),console.log(`Success Rate: ${(this.results.successfulOperations/this.results.totalOperations*100).toFixed(2)}%`);const i=this.results.operations.filter(n=>!n.success);i.length>0&&(console.log(`
❌ Failed Operations:`),i.forEach(n=>{console.log(`  - ${n.type}: ${n.error} (${n.duration.toFixed(2)}ms)`)}));const a=[...this.results.operations].sort((n,m)=>m.duration-n.duration).slice(0,5);return console.log(`
🐌 Slowest Operations:`),a.forEach(n=>{console.log(`  - ${n.type}: ${n.duration.toFixed(2)}ms ${n.success?"✅":"❌"}`)}),this.results}reset(){this.results={totalOperations:0,successfulOperations:0,failedOperations:0,averageResponseTime:0,operations:[]}}}const S=new U;typeof window<"u"&&(window.stressTest=S);const W=()=>{const{user:h}=B(),[r,s]=k.useState(!1);return k.useEffect(()=>{const n=new URLSearchParams(window.location.search).get("dev"),m=localStorage.getItem("passport_buddy_dev_mode");(h&&["izaacap@gmail.com"].includes(h.email)||n==="letmein123"||m==="true")&&(s(!0),n==="letmein123"&&localStorage.setItem("passport_buddy_dev_mode","true"))},[h]),{isDevMode:r,disableDevMode:()=>{s(!1),localStorage.removeItem("passport_buddy_dev_mode")}}},q=()=>{const[h,r]=k.useState(!1),[s,i]=k.useState(null),[a,n]=k.useState("notification-stress"),[m,l]=k.useState([]),{data:f}=z(),{isDevMode:v,disableDevMode:D}=W(),A=async()=>{const o="http://localhost:3000",w=localStorage.getItem("passport_buddy_token");if(!w){alert("Please log in first");return}r(!0),l(["🚀 TWITTER FEED STRESS TEST - SEED FRIENDS & CONTENT","=".repeat(50)]);try{const O=[{username:"sarah_travels",email:"sarah@example.com",fullName:"Sarah Chen",password:"Test123!"},{username:"mike_wanderer",email:"mike@example.com",fullName:"Mike Johnson",password:"Test123!"},{username:"jenny_explorer",email:"jenny@example.com",fullName:"Jenny Smith",password:"Test123!"},{username:"alex_nomad",email:"alex@example.com",fullName:"Alex Rivera",password:"Test123!"},{username:"lisa_backpack",email:"lisa@example.com",fullName:"Lisa Wong",password:"Test123!"},{username:"tom_pilot",email:"tom@example.com",fullName:"Tom Harrison",password:"Test123!"},{username:"emma_globe",email:"emma@example.com",fullName:"Emma Davis",password:"Test123!"},{username:"david_miles",email:"david@example.com",fullName:"David Garcia",password:"Test123!"}],T=[];l(e=>[...e,"","🏗️ Building real user network for Twitter-style feed..."]);for(const e of O)try{const d=await fetch(`${o}/api/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(d.ok){const c=await d.json();T.push({_id:c.userId,username:e.username}),l(u=>[...u,`👤 Created real user @${e.username}`])}else{const c=await fetch(`${o}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username,password:e.password})});if(l(u=>[...u,`🔑 LOGIN ATTEMPT - User: ${e.username}, Status: ${c.status}`]),c.ok){const{token:u}=await c.json(),g=await fetch(`${o}/api/v1/users/profile/${e.username}`,{headers:{Authorization:`Bearer ${u}`}});if(g.ok){const{data:p}=await g.json();T.push({_id:p.user._id,username:e.username}),l($=>[...$,`🔄 Found existing @${e.username}`])}}}}catch{l(c=>[...c,`❌ Failed to create @${e.username}`])}const y=T;l(e=>[...e,"",`📊 Found ${y.length} users to seed with`]),l(e=>[...e,"","🤝 PHASE 1: Building Friend Network","Creating mutual connections like Twitter..."]);for(let e=0;e<Math.min(15,y.length);e++){const d=y[e];try{const c=await fetch(`${o}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:d.username,password:"Test123!"})});if(c.ok){const{token:u}=await c.json(),g=await fetch(`${o}/api/v1/users/profile/izaacap`,{headers:{Authorization:`Bearer ${u}`}});if(g.ok){const{data:p}=await g.json();await fetch(`${o}/api/v1/users/follow/${p.user._id}`,{method:"POST",headers:{Authorization:`Bearer ${u}`}}),l($=>[...$,`🔄 @${d.username} followed you`])}await fetch(`${o}/api/v1/users/follow/${d._id}`,{method:"POST",headers:{Authorization:`Bearer ${w}`}}),l(p=>[...p,`🤝 You followed @${d.username} back`])}}catch{l(u=>[...u,`❌ Connection failed with @${d.username}`])}e%4===0&&await new Promise(c=>setTimeout(c,200))}l(e=>[...e,"","🌐 Friend network established!"]),l(e=>[...e,"","📝 PHASE 2: Creating Diverse Content Feed"]);const j=["Hot take: Window seats > aisle seats and I will die on this hill ✈️","Currently stuck in Istanbul airport for 6 hours. AMA about duty free prices 🙃","PSA: Always pack a change of clothes in your carry-on. Trust me on this one 🧳","That moment when you realize you forgot to pack underwear... asking for a friend 😅","Flight delayed 3 hours but the airport WiFi is fire so not even mad 📶","Why do airports sell $8 water bottles but give away free WiFi passwords? Make it make sense 🤔","Turbulence update: My coffee is now modern art on my laptop 🎨☕",`Pilot just said "slight delay" - translation: we're never leaving 😭`,"Airport food hits different when you're starving at gate B42 at 6am 🍔",'Boarding group 9... aka "please wait until everyone else has taken the overhead bins" 📦',"Travel hack: Befriend the gate agent. They have more power than you think 💪","Nothing humbles you like trying to fit your life into a 23kg suitcase 🧳⚖️"],b=[];for(let e=0;e<4;e++){const d=j[e],c=new FormData;c.append("content",d);const u=await fetch(`${o}/api/posts`,{method:"POST",headers:{Authorization:`Bearer ${w}`},body:c});if(u.ok){const g=await u.json();b.push(g),l(p=>[...p,`📱 You: "${d.substring(0,40)}..."`])}}l(e=>[...e,"","👥 Friends are also posting..."]);const R=[];for(let e=0;e<Math.min(8,y.length);e++){const d=y[e],c=j[4+e]||"Just had the weirdest travel experience... story time! 🧵";try{const u=await fetch(`${o}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:d.username,password:"Test123!"})});if(u.ok){const{token:g}=await u.json(),p=new FormData;p.append("content",c);const $=await fetch(`${o}/api/posts`,{method:"POST",headers:{Authorization:`Bearer ${g}`},body:p});if($.ok){const M=await $.json();R.push({...M,author:d}),l(_=>[..._,`📝 @${d.username}: "${c.substring(0,35)}..."`])}}}catch{}}l(e=>[...e,"","🔥 PHASE 3: Twitter Engagement Madness!"]);const N=["This!!! 💯","Big mood 😭","Why is this so accurate lmaooo","Felt this in my soul","Period!! 🗣️","Say it louder for the people in the back","The accuracy is painful 😩","Not you calling me out like this","This tweet right here officer","I am DECEASED 💀","The way I just screamed","Ok but why did I need to see this today","Taking notes ✍️","Bookmark for later","RT RT RT","Thread incoming...","Someone had to say it","Facts only 📠"],P=[...b,...R];for(const e of P){const d=y.sort(()=>Math.random()-.5).slice(0,Math.floor(Math.random()*8)+3);for(const c of d)if(!(e.author&&e.author._id===c._id))try{const u=await fetch(`${o}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c.username,password:"Test123!"})});if(u.ok){const{token:g}=await u.json();Math.random()<.8&&await fetch(`${o}/api/posts/${e._id}/like`,{method:"POST",headers:{Authorization:`Bearer ${g}`}}),Math.random()<.4?(await fetch(`${o}/api/posts/${e._id}/comment`,{method:"POST",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"},body:JSON.stringify({content:N[Math.floor(Math.random()*N.length)]})}),l(p=>[...p,`💬 @${c.username} replied with fire`])):l(p=>[...p,`❤️ @${c.username} liked a post`])}}catch{}}l(e=>[...e,"","🎯".repeat(20),"","✨ TWITTER FEED STRESS TEST COMPLETE! ✨","","📊 Generated:",`   • ${Math.min(15,y.length)} mutual friend connections`,`   • ${P.length} diverse posts across your network`,"   • 100+ likes, comments, and interactions","   • Real Twitter-style feed experience","","👉 Check your notifications bell (red dot should be lit!)","📱 Your feed should now be buzzing with friend activity!","🔔 Notifications styled like Twitter/Tumblr as requested!"])}catch(O){l(T=>[...T,`❌ Error: ${O}`])}finally{r(!1)}},F=async()=>{if(a==="notification-stress")return A();if(!(f!=null&&f.posts.length)){alert("No posts available for testing");return}r(!0),i(null),S.reset();try{let o;const w=f.posts[0]._id,O=f.posts.map(T=>T._id);switch(a){case"concurrent-likes":o=await S.runConcurrentLikeTest(w,20);break;case"concurrent-comments":o=await S.runConcurrentCommentTest(w,15);break;case"mixed-operations":o=await S.runMixedOperationsTest(O,30);break;case"rapid-fire":o=await S.runRapidFireTest(w,3e3);break;case"auth-stress":o=await S.runAuthenticationStressTest(5);break;default:throw new Error("Unknown test type")}i(o)}catch(o){console.error("Stress test error:",o)}finally{r(!1)}};return v?t.jsxs("div",{className:"stress-test-panel",children:[t.jsxs("div",{className:"panel-header",children:[t.jsx("h3",{children:"Stress Test Panel"}),t.jsx("button",{className:"close-btn",onClick:D,title:"Close Dev Tools",children:"×"})]}),t.jsxs("div",{className:"test-selector",children:[t.jsx("label",{children:"Select Test:"}),t.jsxs("select",{value:a,onChange:o=>n(o.target.value),disabled:h,children:[t.jsx("option",{value:"notification-stress",children:"🐦 Twitter Feed Stress Test (Seed Friends & Content)"}),t.jsx("option",{value:"concurrent-likes",children:"Concurrent Likes (20x)"}),t.jsx("option",{value:"concurrent-comments",children:"Concurrent Comments (15x)"}),t.jsx("option",{value:"mixed-operations",children:"Mixed Operations (30x)"}),t.jsx("option",{value:"rapid-fire",children:"Rapid Fire Likes (3s)"}),t.jsx("option",{value:"auth-stress",children:"Authentication Stress (5x)"})]})]}),t.jsx("button",{className:"run-test-btn",onClick:F,disabled:h||a!=="notification-stress"&&!(f!=null&&f.posts.length),children:h?"Running Test...":"Run Stress Test"}),m.length>0&&t.jsxs("div",{className:"test-results",children:[t.jsx("h4",{children:"Notification Stress Test Log:"}),t.jsx("div",{style:{backgroundColor:"#000",color:"#0f0",padding:"10px",borderRadius:"5px",fontFamily:"monospace",fontSize:"12px",maxHeight:"300px",overflowY:"auto"},children:m.map((o,w)=>t.jsx("div",{children:o},w))})]}),s&&t.jsxs("div",{className:"test-results",children:[t.jsx("h4",{children:"Test Results:"}),t.jsxs("div",{className:"result-stats",children:[t.jsxs("div",{className:"stat",children:[t.jsx("span",{className:"stat-label",children:"Total Operations:"}),t.jsx("span",{className:"stat-value",children:s.totalOperations})]}),t.jsxs("div",{className:"stat success",children:[t.jsx("span",{className:"stat-label",children:"Successful:"}),t.jsx("span",{className:"stat-value",children:s.successfulOperations})]}),t.jsxs("div",{className:"stat error",children:[t.jsx("span",{className:"stat-label",children:"Failed:"}),t.jsx("span",{className:"stat-value",children:s.failedOperations})]}),t.jsxs("div",{className:"stat",children:[t.jsx("span",{className:"stat-label",children:"Avg Response Time:"}),t.jsxs("span",{className:"stat-value",children:[s.averageResponseTime.toFixed(2),"ms"]})]}),t.jsxs("div",{className:"stat",children:[t.jsx("span",{className:"stat-label",children:"Success Rate:"}),t.jsxs("span",{className:"stat-value",children:[(s.successfulOperations/s.totalOperations*100).toFixed(2),"%"]})]})]}),s.operations&&s.operations.filter(o=>!o.success).length>0&&t.jsxs("div",{className:"failed-operations",children:[t.jsx("h5",{children:"Failed Operations:"}),s.operations.filter(o=>!o.success).map((o,w)=>t.jsxs("div",{className:"failed-op",children:[o.type,": ",o.error," (",o.duration.toFixed(2),"ms)"]},w))]})]})]}):null};export{q as StressTestPanel};
